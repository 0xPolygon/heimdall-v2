syntax = "proto3";
package heimdallv2.topup;

import "cosmos_proto/cosmos.proto";
import "cosmos/query/v1/query.proto";
import "gogoproto/gogo.proto";
import "google/api/annotations.proto";
import "heimdallv2/types/dividend_account.proto";
import "heimdallv2/topup/topup.proto";
import "amino/amino.proto";

option go_package = "github.com/0xPolygon/heimdall-v2/x/topup/types";

// Query defines the gRPC query service for the topup module.
service Query {
  // IsTopupTxOld checks if a topup transaction has already been processed.
  rpc IsTopupTxOld(QueryTopupSequenceRequest)
      returns (QueryIsTopupTxOldResponse) {
    option (google.api.http).get = "/topup/is-old-tx";
  }
  // GetTopupTxSequence returns the sequence number for a topup transaction.
  rpc GetTopupTxSequence(QueryTopupSequenceRequest)
      returns (QueryTopupSequenceResponse) {
    option (google.api.http).get = "/topup/sequence";
  }
  // GetDividendAccountByAddress queries a dividend account by address.
  rpc GetDividendAccountByAddress(QueryDividendAccountRequest)
      returns (QueryDividendAccountResponse) {
    option (cosmos.query.v1.module_query_safe) = true;
    option (google.api.http).get = "/topup/dividend-account/{address}";
  }
  // GetDividendAccountRootHash calculates the Merkle root of all dividend
  // accounts.
  rpc GetDividendAccountRootHash(QueryDividendAccountRootHashRequest)
      returns (QueryDividendAccountRootHashResponse) {
    option (cosmos.query.v1.module_query_safe) = true;
    option (google.api.http).get = "/topup/dividend-account-root";
  }
  // VerifyAccountProofByAddress verifies an account proof for a given address.
  rpc VerifyAccountProofByAddress(QueryVerifyAccountProofRequest)
      returns (QueryVerifyAccountProofResponse) {
    option (cosmos.query.v1.module_query_safe) = true;
    option (google.api.http).get = "/topup/account-proof/{address}/verify";
  }
  // GetAccountProofByAddress retrieves the account proof for a given address.
  rpc GetAccountProofByAddress(QueryAccountProofRequest)
      returns (QueryAccountProofResponse) {
    option (google.api.http).get = "/topup/account-proof/{address}";
  }
}

// QueryTopupSequenceRequest is the request type for the GetTopupTxSequence and
// IsTopupTxOld queries.
message QueryTopupSequenceRequest {
  // Root chain transaction hash.
  string tx_hash = 1 [ (amino.dont_omitempty) = true ];
  // Log index in root chain transaction.
  uint64 log_index = 2 [ (amino.dont_omitempty) = true ];
}

// QueryTopupSequenceResponse is the response type for the GetTopupTxSequence
// query.
message QueryTopupSequenceResponse {
  // Sequence number for the topup transaction.
  string sequence = 1 [ (amino.dont_omitempty) = true ];
}

// QueryIsTopupTxOldResponse is the response type for the IsTopupTxOld query.
message QueryIsTopupTxOldResponse {
  // True if the transaction has already been processed.
  bool is_old = 1 [ (amino.dont_omitempty) = true ];
}

// QueryDividendAccountRequest is the request type for the
// GetDividendAccountByAddress query.
message QueryDividendAccountRequest {
  // Address of the account to query.
  string address = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (amino.dont_omitempty) = true
  ];
}

// QueryDividendAccountResponse is the response type for the
// GetDividendAccountByAddress query.
message QueryDividendAccountResponse {
  // The requested dividend account.
  heimdallv2.types.DividendAccount dividend_account = 1
      [ (gogoproto.nullable) = false, (amino.dont_omitempty) = true ];
}

// QueryDividendAccountRootHashRequest is the request type for the
// GetDividendAccountRootHash query.
message QueryDividendAccountRootHashRequest {}

// QueryDividendAccountRootHashResponse is the response type for the
// GetDividendAccountRootHash query.
message QueryDividendAccountRootHashResponse {
  // Merkle root hash of all dividend accounts.
  bytes account_root_hash = 1 [ (amino.dont_omitempty) = true ];
}

// QueryVerifyAccountProofRequest is the request type for the
// VerifyAccountProofByAddress query.
message QueryVerifyAccountProofRequest {
  // Address of the account to verify.
  string address = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (amino.dont_omitempty) = true
  ];
  // Merkle proof to verify.
  string proof = 2 [ (amino.dont_omitempty) = true ];
}

// QueryVerifyAccountProofResponse is the response type for the
// VerifyAccountProofByAddress query.
message QueryVerifyAccountProofResponse {
  // True if the proof is valid.
  bool is_verified = 1 [ (amino.dont_omitempty) = true ];
}

// QueryAccountProofRequest is the request type for the
// GetAccountProofByAddress query.
message QueryAccountProofRequest {
  // Address of the account to get proof for.
  string address = 1 [
    (cosmos_proto.scalar) = "cosmos.AddressString",
    (amino.dont_omitempty) = true
  ];
}

// QueryAccountProofResponse is the response type for the
// GetAccountProofByAddress query.
message QueryAccountProofResponse {
  // Merkle proof for the requested account.
  AccountProof proof = 1
      [ (gogoproto.nullable) = false, (amino.dont_omitempty) = true ];
}
