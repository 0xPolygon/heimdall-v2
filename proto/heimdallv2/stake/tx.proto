syntax = "proto3";
package heimdallv2.stake;

import "gogoproto/gogo.proto";

import "cosmos_proto/cosmos.proto";
import "cosmos/msg/v1/msg.proto";
import "amino/amino.proto";

option go_package = "github.com/0xPolygon/heimdall-v2/x/stake/types";

// Msg defines the gRPC message service for the stake module.
service Msg {
  option (cosmos.msg.v1.service) = true;

  // ValidatorJoin processes a new validator joining the network.
  rpc ValidatorJoin(MsgValidatorJoin) returns (MsgValidatorJoinResponse);

  // StakeUpdate processes an update to a validator's stake amount.
  rpc StakeUpdate(MsgStakeUpdate) returns (MsgStakeUpdateResponse);

  // SignerUpdate processes an update to a validator's signer public key.
  rpc SignerUpdate(MsgSignerUpdate) returns (MsgSignerUpdateResponse);

  // ValidatorExit processes a validator exiting the network.
  rpc ValidatorExit(MsgValidatorExit) returns (MsgValidatorExitResponse);
}

// MsgValidatorJoin defines the message for a new validator joining the network.
// This is triggered by stake events from the root chain.
message MsgValidatorJoin {
  option (cosmos.msg.v1.signer) = "from";
  option (amino.name) = "heimdallv2/stake/MsgValidatorJoin";
  option (gogoproto.equal) = false;
  option (gogoproto.goproto_getters) = true;
  string from = 1 [
    (amino.dont_omitempty) = true,
    (cosmos_proto.scalar) = "cosmos.AddressString"
  ];
  uint64 val_id = 2 [ (amino.dont_omitempty) = true ]; // Validator ID
  uint64 activation_epoch = 3
      [ (amino.dont_omitempty) = true ]; // Epoch when validator becomes active
  string amount = 4 [
    (gogoproto.nullable) = false,
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (amino.dont_omitempty) = true
  ]; // Staked amount
  bytes signer_pub_key = 5
      [ (amino.dont_omitempty) = true ]; // Public key for block signing
  bytes tx_hash = 6
      [ (amino.dont_omitempty) = true ]; // Root chain transaction hash
  uint64 log_index = 7
      [ (amino.dont_omitempty) = true ]; // Log index in root chain tx
  uint64 block_number = 8
      [ (amino.dont_omitempty) = true ]; // Root chain block number
  uint64 nonce = 9
      [ (amino.dont_omitempty) = true ]; // Nonce for replay protection
}

// MsgValidatorJoinResponse defines the response for MsgValidatorJoin.
message MsgValidatorJoinResponse {}

// MsgStakeUpdate defines the message for updating a validator's stake amount.
message MsgStakeUpdate {
  option (cosmos.msg.v1.signer) = "from";
  option (amino.name) = "heimdallv2/stake/MsgStakeUpdate";
  option (gogoproto.equal) = false;
  option (gogoproto.goproto_getters) = true;
  string from = 1 [
    (amino.dont_omitempty) = true,
    (cosmos_proto.scalar) = "cosmos.AddressString"
  ];
  uint64 val_id = 2 [ (amino.dont_omitempty) = true ];
  string new_amount = 3 [
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true,
    (gogoproto.customtype) = "cosmossdk.io/math.Int"
  ]; // New stake amount
  bytes tx_hash = 4 [ (amino.dont_omitempty) = true ];
  uint64 log_index = 5 [ (amino.dont_omitempty) = true ];
  uint64 block_number = 6 [ (amino.dont_omitempty) = true ];
  uint64 nonce = 7 [ (amino.dont_omitempty) = true ];
}

// MsgStakeUpdateResponse defines the response for MsgStakeUpdate.
message MsgStakeUpdateResponse {}

// MsgSignerUpdate defines the message for updating a validator's signer public
// key.
message MsgSignerUpdate {
  option (cosmos.msg.v1.signer) = "from";
  option (amino.name) = "heimdallv2/stake/MsgSignerUpdate";
  option (gogoproto.equal) = false;
  option (gogoproto.goproto_getters) = true;
  string from = 1 [
    (amino.dont_omitempty) = true,
    (cosmos_proto.scalar) = "cosmos.AddressString"
  ];
  uint64 val_id = 2 [ (amino.dont_omitempty) = true ];
  bytes new_signer_pub_key = 3
      [ (amino.dont_omitempty) = true ]; // New public key for block signing
  bytes tx_hash = 4 [ (amino.dont_omitempty) = true ];
  uint64 log_index = 5 [ (amino.dont_omitempty) = true ];
  uint64 block_number = 6 [ (amino.dont_omitempty) = true ];
  uint64 nonce = 7 [ (amino.dont_omitempty) = true ];
}

// MsgSignerUpdateResponse defines the response for MsgSignerUpdate.
message MsgSignerUpdateResponse {}

// MsgValidatorExit defines the message for a validator exiting the network.
message MsgValidatorExit {
  option (cosmos.msg.v1.signer) = "from";
  option (amino.name) = "heimdallv2/stake/MsgValidatorExit";
  option (gogoproto.equal) = false;
  option (gogoproto.goproto_getters) = true;
  string from = 1 [
    (amino.dont_omitempty) = true,
    (cosmos_proto.scalar) = "cosmos.AddressString"
  ];
  uint64 val_id = 2 [ (amino.dont_omitempty) = true ];
  uint64 deactivation_epoch = 3
      [ (amino.dont_omitempty) =
            true ]; // Epoch when validator becomes inactive
  bytes tx_hash = 4 [ (amino.dont_omitempty) = true ];
  uint64 log_index = 5 [ (amino.dont_omitempty) = true ];
  uint64 block_number = 6 [ (amino.dont_omitempty) = true ];
  uint64 nonce = 7 [ (amino.dont_omitempty) = true ];
}

// MsgValidatorExitResponse defines the response for MsgValidatorExit.
message MsgValidatorExitResponse {}
